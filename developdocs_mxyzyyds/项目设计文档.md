# COLLECT迭代三项目设计文档

## 文档信息

### 小组信息

### 基本信息

### 修改记录

## 引言

### 目的

本文档描述了COLLECT的用户需求，为后期开发人员对系统的实现和验证工作提供指导，且面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

==在实际访问网站时，由于报告协作、报告推荐等功能需要一定的已有数据，否则难以体现效果，因此请检查时参考网页前端说明和`项目设计文档`内`4.1用户界面层分解`的截图==

### 产品前景

COLLECT（**Collaborative** **Crowdsourced Testing Platform**）是一个**协作式众包测试平台**。众包测试对复杂真实应用场景和真实用户表现的良好模拟，具有测试周期短，测试成本低等优势，具备广阔的前景。

### 范围

本系统的开发将采取螺旋开发模型。迭代一中涉及的范围仅涉及下文描述的迭代一所列需求。迭代一中本平台将具有基本众包测试流程和众测报告可视化两个功能。具体如下。

1.**用户管理**：用户注册、登陆、角色设置（发包方、众包工人、管理员）。

2.**任务发布**：发包方上传待测应用及测试文档、设定任务需求、发布众测任务。

3.**任务浏览**：系统用户可浏览相应众测任务。

4.**任务选取**：众包工人选取任务、下载相应文档及待测应用、离线完成测试。

5.**报告提交**：众包工人在线填写测试报告。

6.**报告展示**：发包方通过系统在线查看众包工人提交的测试报告。

迭代二中将会加入如下功能。

1.**任务推荐：**通过收集众包工人及众测任务特性，进行基于属性的众测任务推荐，使得众包工人可以选择更适合的任务，也使众包任务得到更好的完成。

2.**报告审查：**采用文本或图像相似度计算算法，在众包工人提交测试报告时和该任务已有报告进行相似度计算，并展示相似的报告，引导用户进行**报告协作**。

3.**报告评价：**众包工人对其他众包工人所提交的测试报告进行量化评分（1-5），可以进行描述评价，也可选择在原始报告基础上补充说明，进一步进行新的报告提交（**报告协作**），从而帮助发包方进行测试报告质量控制。

4.**报告协作：**众包工人对同一测试任务可进行协作，即众包工人在报告审查中发现相似报告或审查到低质量报告，则在已提交的报告上进行进一步补充说明。

在迭代三，我们的主选题是**众测工人评分框架**。为了实现这一主题的目标，我们将实现以下功能：

1.**众包工人个人主页**：为众包工人建立个人详情页，在详情页中量化并显示其测试能力。

2.**低质量报告获取**：筛选低质量报告（工人评分低），并邀请接了同一任务的工人与其协作。

3.**发包方评审机制**：发包方可以对自己发布任务下的报告进行评分，并被赋予一个较高的权值，此数据可以用于报告评分展示、工人能力评分等。

3.**发包方用户推荐与邀请**：发包方获得适合自己的任务的众包工人用户的推荐。发包方可以向这些用户发送测试邀约。

除此以外，我们还将会系统性地优化我们的整体前端框架，添加更多更实用的信息和提示和更灵活多样的跳转。例如，可以点击的关系图和可以跳转的消息。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528025756212.png" alt="image-20220528025756212" style="zoom: 67%;" />

### 定义

**众包测试**，指的是召集大量众包工人，以软件用户的身份在线完成测试任务的一种测试方式。

**协作式众包测试**则在此基础上还具有工人群体智能汇聚、测试过程评价机制、测试结果聚合优化等特点。

###  参考文献

【1】.  IEEE相关标准[IEEE830-1998];

【2】.  软件工程与计算（卷二）：软件开发的技术基础 / 骆斌主编. ——北京：机械工业出版社, 2012.12;

【3】.  软件工程与计算（卷三）：团队与软件开发实践 / 骆斌主编. ——北京：机械工业出版社, 2012.12;

## 架构设计

### 逻辑视图

#### 参照体系结构风格的表达逻辑视角的包图

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304104738479.png" alt="image-20220304104738479" style="zoom: 67%;" />



#### 软件体系结构逻辑设计方案

![image-20220528154723047](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528154723047.png)



### 组合视图

#### 开发包图

##### 服务端开发包图

![image-20220528154801803](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528154801803.png)



##### 浏览器端开发包图

![image-20220528160756012](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528160756012.png)



#### 运行时进程

![image-20220330194332308](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220330194332308.png)



#### 物理部署

![image-20220401202845923](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401202845923.png)



### 模块职责

#### 概述

##### **服务端的模块视图**

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE2/5A446/HW_03/image-20210523195348337.png" alt="image-20210523195348337" style="zoom:67%;" />

|     层     |                   职责                   |
| :--------: | :--------------------------------------: |
| 前端服务端 |           为浏览器提供前端资源           |
| 业务逻辑层 | 对从前端和浏览器端发来的请求进行业务处理 |
|   数据层   |     负责数据的持久化以及数据访问接口     |

##### **浏览器端模块视图**

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE2/5A446/HW_03/image-20210523202052171.png" alt="image-20210523202052171" style="zoom:80%;" />

|     层     |                      职责                      |
| :--------: | :--------------------------------------------: |
| 用户界面层 |           展示界面，并与用户进行交互           |
| 前端逻辑层 | 在前端进行一些业务逻辑的简单处理并与服务端交互 |

#### 用户界面层

##### 产品界面跳转逻辑

==在实际访问网站时，由于报告协作、报告推荐等功能需要一定的已有数据，否则难以体现效果，因此请检查时参考网站前端和`项目设计文档`内`4.1用户界面层分解`的截图==

![image-20220528154922069](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528154922069.png)

##### 包的结构与职责

包的划分详见上文的开发包图。具体详情请见详细设计部分。

| 包名           | 作用                               | 备注 |
| -------------- | ---------------------------------- | ---- |
| view.publisher | 仅发包方的页面                     |      |
| view.worker    | 仅众包工人的页面                   |      |
| view.admin     | 仅管理员的页面                     |      |
| view.public    | 不需要登陆但是要和后端交互的页面   |      |
| view.common    | 两个及以上角色要查看的页面         |      |
| view.static    | 不需要登陆且不需要和后端交互的页面 |      |
| api            | 与后端交互发请求的包               |      |
| components     | 其他页面用到的组件                 |      |
| router         | 路由                               |      |
| store          | vuex存储                           |      |



#### 业务逻辑层

##### 包的结构与职责

![image-20220401083402165](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401083402165.png)

系统采用了分层设计的方法，Java端具体功能和职责在服务端开发包图中已经呈现，更多详情见**详细设计**的**业务逻辑层分解**部分。

#### 数据层

##### 包的结构与职责

在业务逻辑到数据层层间接口上，我们使用了MyBatis来减少工作量。绝大部分的方法由MyBatis自动生成。业务逻辑层调用Mapper层的接口，而后再转化为对数据库的真实访问。这些代码都在`dao`包下。详情见**详细设计**的**数据层分解**部分。

### 信息视角

#### 实体关系图

![image-20220528225123683](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528225123683.png)

#### 持久化信息内容

详情见详细设计部分的数据库具体设计部分。



### CI/CD与自动化测试

#### Jenkins

##### 部署情况

Jenkins访问地址：http://ydj.ydjsir.com.cn:8080/

| 账号 | 密码          |
| ---- | ------------- |
| se3  | SHa8ash**hcas |

该容器运行在一台腾讯轻量云服务器（上海，4C4G8M）的Docker容器中，通过Agent的方式，控制另一台腾讯轻量服务器（上海，4C4G8M）进行代码拉取、自动构建打包测试与发布等工作。

Jenkins通过南大Git上的镜像仓库获得WebHook推送和代码，相关操作均按照文档进行。目前已经能实现JUnit测试结果和基于JaCoCo的测试覆盖率报告收集并能够在Jenkins网页上展示。前后端在生产环境中均运行在容器内。目前设置上以`master`分支为生产环境，仅该分支的推送会触发构建。构建状态会用GitLab Connection推回给南大Git。

生产环境（网站）访问链接：https://se3.ydjsir.com.cn/

HTTP请求会被重定向到HTTPS以实现强制HTTPS访问。

关于部署详情，请查看部署文档。

##### 后端（Java Maven项目）流水线脚本

```groovy
pipeline { 
    agent any  
    stages { 
        stage('SCM from Mirror') { 
            steps { 
               git url: 'git@git.nju.edu.cn:YDJSIR/191250186_mxyzyyds_backend_mxyzyyds.git'
               sh "ls -al"
            }
        }
        stage('Build') { 
            steps { 
               sh "chmod +x mvnw"
               sh "./mvnw install"
               junit 'target/surefire-reports/*.xml'
               step( [ $class: 'JacocoPublisher' ] )
            }
            post {
                failure {
                    updateGitlabCommitStatus name: 'build', state: 'failed'
                }
                success {
                    updateGitlabCommitStatus name:'build', state: 'success'
                }
            }
        }
        stage('Launch') {
            steps { 
               sh "/usr/local/shell/start_collect_backend.sh"
            }
        }
    }
}
```

脚本中引用的`/usr/local/shell/start_collect_backend.sh`内容如下。

```bash
cd /home/webroot/workspace/COLLECT-Backend
ls -al
docker stop collect-backend
docker rm collect-backend
docker system prune -f
docker build . -t collect-backend --no-cache
docker run -d --name collect-backend -p 8888:8888 --restart unless-stopped  collect-backend:latest  /bin/bash -c "java -jar target/collect*.jar; tail -f /dev/null"
exit
exit
```



##### 前端（基于Node.js的Vue项目）流水线脚本

```groovy
pipeline { 
    agent any  
    stages { 
        stage('SCM from Mirror') { 
            steps { 
               git url: 'git@git.nju.edu.cn:YDJSIR/191250186_mxyzyyds_frontend_mxyzyyds.git'
               sh "ls -al"
               sh "pwd"
            }
        }
        stage('Build') { 
            steps { 
               sh "/usr/local/shell/start_collect_frontend.sh"
            }
            post {
                failure {
                    updateGitlabCommitStatus name: 'build', state: 'failed'
                }
                success {
                    updateGitlabCommitStatus name:'build', state: 'success'
                }
            }
        }
        stage('Post') {
            steps { 
               sh "docker ps -a | grep collect-frontend"
            }
        }
    }
}
```

脚本中引用的`/usr/local/shell/start_collect_frontend.sh`内容如下。

```bash
cd /home/webroot/workspace/COLLECT-Frontend
ls -al
pwd
docker stop collect-frontend
docker rm collect-frontend
docker build --no-cache . -t collect-frontend
docker run -d --name collect-frontend --restart unless-stopped -p 80:80 -p 443:443 collect-frontend:latest /bin/bash -c "nginx; tail -f /dev/null"
exit
exit

```



##### Python服务（flask+gunicorn项目）流水线脚本

```groovy
pipeline { 
    agent any  
    stages { 
        stage('SCM from Mirror') { 
            steps { 
               git url: 'git@git.nju.edu.cn:YDJSIR/191250186_mxyzyyds_python_mxyzyyds.git'
               sh "ls -al"
            }
        }
        stage('Build') { 
            steps { 
                sh "docker stop sim"
                sh "docker build -t se3python ."
            }
            post {
                failure {
                    updateGitlabCommitStatus name: 'build', state: 'failed'
                }
                success {
                    updateGitlabCommitStatus name:'build', state: 'success'
                }
            }
        }
        stage('Launch') {
            steps { 
               sh "docker run --rm -d -p 5000:5000 --name sim se3python"
               sh "docker system prune -f"
            }
        }
    }
}
```



##### 效果展示

![image-20220330193606894](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220330193606894.png)

![image-20220304112124935](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304112124935.png)

![image-20220304112045381](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304112045381.png)

![image-20220330193722422](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220330193722422.png)



#### Apifox

本系统的开发使用了Apifox进行接口管理与自动化测试。这在测试文档中将有所体现。

## 详细设计

==在实际访问网站时，由于报告协作、报告推荐等功能需要一定的已有数据，否则难以体现效果，因此请检查时参考`DEMO数据说明`文档和`项目设计文档`内`4.1用户界面层分解`的截图==

### 用户界面层分解

总览依赖图如下。

![image-20220528155636818](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528155636818.png)

页面跳转逻辑如**架构设计**中**模块设计**的**用户界面层**的产品界面跳转逻辑图所示，此处不再赘述。

#### 公开页面 `src/public`

##### `Login.vue`

这是登陆页面。

![image-20220402144811478](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402144811478.png)

![image-20220528161322642](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528161322642.png)

##### `Register.vue`

这是注册页面。

![image-20220402144827862](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402144827862.png)

![image-20220528161545033](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528161545033.png)

#### 通用页面`src/common`

##### `newReportPage.vue`

这是缺陷报告查看页面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213721414.png" alt="image-20220528213721414" style="zoom: 50%;" />

![image-20220528164828542](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528164828542.png)

可以查看该页面的补充报告列表。

![image-20220528164851515](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528164851515.png)

也可以查看其他众包工人对该报告的评价。

![image-20220528164913384](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528164913384.png)

如果是发包方来看的话，还可以进行报告的评审。

![image-20220528213631123](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213631123.png)



![image-20220528213651795](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213651795.png)

##### `tasksPlayground.vue`

这是任务广场页面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213811106.png" alt="image-20220528213811106" style="zoom: 50%;" />

![image-20220528165033054](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528165033054.png)




##### `userLayout.vue`

这是用户登录后的用户中心页面。管理员配置系统设置的界面也夹在其中。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213856017.png" alt="image-20220528213856017" style="zoom: 50%;" />

众包工人看到的页面如下。

![image-20220528161656595](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528161656595.png)

发包方看到的页面如下。

![image-20220528161736061](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528161736061.png)

管理员看到的页面如下。

![image-20220528161906918](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528161906918.png)

##### `testPage.vue`

这是任务详情页。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528213928116.png" alt="image-20220528213928116" style="zoom: 50%;" />

众包工人看这个页面，会获得任务推荐。

![image-20220528173059179](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528173059179.png)

如果该众包工人已经接受并完成该任务，他可以获得低质量报告列表并协作（工人相互评价均分低于4）

![image-20220528181027415](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181027415.png)

如果是发包方来看，则会获得用户推荐。

![image-20220528181510064](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181510064.png)

##### `messages.vue`

这是消息中心页面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528214144556.png" alt="image-20220528214144556" style="zoom:50%;" />

![image-20220528181528899](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181528899.png)

##### `additionalReport.vue`

这是补充报告的详情页。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528214214925.png" alt="image-20220528214214925" style="zoom:50%;" />

![image-20220528182252029](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528182252029.png)



##### `userInfo.vue`

这是用户信息页面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528214256767.png" alt="image-20220528214256767" style="zoom: 50%;" />

![image-20220528182357296](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528182357296.png)



#### 静态页面 `src/static`

这部分的网页没有什么对外的接口依赖，故从略。

##### `About.vue`

![image-20220528181559522](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181559522.png)

默认访问网站的首页，有团队介绍等基础信息。

##### `404.vue`

![image-20220528181616013](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181616013.png)

网站的404错误页。

#### 管理员页面 `src/admin`

##### `allTask.vue`

这是管理员查看所有任务所使用的页面。

![image-20220402153711388](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402153711388.png)



![image-20220528181740955](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181740955.png)



#### 发包方页面 `src/publisher`

##### `addTask.vue`

这是发包方发布任务的页面。

![image-20220402151943615](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402151943615.png)

![image-20220528181708398](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181708398.png)



##### `myTasks.vue`

这是发包方查看自己发布的任务的页面。

![image-20220402151502034](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402151502034.png)

![image-20220528181811413](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181811413.png)

##### `reportList.vue`

这是发包方查看自己发布的某一任务的聚合报告的页面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528214352444.png" alt="image-20220528214352444" style="zoom: 67%;" />

![image-20220528181837101](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181837101.png)



#### 众包工人页面`src/worker`

##### `submitReport.vue`

这是众包工人提交缺陷报告的页面。

![image-20220402152345535](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402152345535.png)



![image-20220528182006465](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528182006465.png)



##### `taskListHistory.vue`

这是众包工人查看自己历史已完成的任务的页面。

![image-20220402152056358](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402152056358.png)



![image-20220528181920094](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528181920094.png)



##### `taskListProcessing.vue`

这是众包工人查看自己正在处理的任务的页面。

![image-20220402152035120](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402152035120.png)



![image-20220528182030831](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528182030831.png)



##### `collaborateReportPage.vue`

这是众包工人协作报告，发布补充报告的页面。

![image-20220402151625042](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402151625042.png)



![image-20220528182132660](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528182132660.png)



### 业务逻辑层分解

#### 用户部分

##### serviceimpl.user

###### 模块概述

serviceimpl.user模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.user.UserService接口。业务逻辑层和数据层之间添加dao.user.UserMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.user模块的设计如图所示。

![image-20220401091648257](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401091648257.png)

serviceimpl.user模块的类的职责

| 模块             | 职责                                           |
| ---------------- | ---------------------------------------------- |
| serviceimpl.user | 负责实现用户的登录、注册功能和用户设备管理功能 |



###### 模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）          |          |                                                              |
| ----------------------------- | -------- | ------------------------------------------------------------ |
|                               | 语法     | ResultVo\<UserVo> userRegister(UserVo userVo)；              |
| UserService.userRegister      | 前置条件 | 用户输入有效的电子邮箱，用户名，密码                         |
|                               | 后置条件 | 数据库中插入一条新的用户记录                                 |
|                               | 语法     | ResultVo\<UserVo> userLogin(String email, String password)； |
| UserService.userLogin         | 前置条件 | 用户输入有效的电子邮箱，密码                                 |
|                               | 后置条件 | 返回用户登录成功的结果                                       |
|                               | 语法     | ResultVo\<UserVo> getUserVo(Integer uid)                     |
| UserService.getUserVo         | 前置条件 | 用户希望获得某用户的公开信息                                 |
|                               | 后置条件 | 系统返回对应的 用户信息                                      |
|                               | 语法     | ResultVo\<UserDeviceVo> addUserDevices(UserDeviceVo userDeviceVo, Integer uid) |
| UserService.addUserDevices    | 前置条件 | 用户增添一条用户记录                                         |
|                               | 后置条件 | 系统返回操作结果                                             |
|                               | 语法     | ResultVo\<UserDeviceVo> deleteUserDevices(Long userDeviceRecordId, Integer uid) |
| UserService.deleteUserDevices | 前置条件 | 用户需要删除某条用户设备记录                                 |
|                               | 后置条件 | 系统返回操作结果                                             |
|                               | 语法     | ResultVo\<UserDeviceVo> updateUserDevices(UserDeviceVo userDeviceVo, Integer uid) |
| UserService.updateUserDevices | 前置条件 | 用户发送需要更新的用户设备记录                               |
|                               | 后置条件 | 系统更新对应记录并返回操作结果                               |
|                               | 语法     | PageInfo\<UserDeviceVo> getUserDevices(Integer currPage, Integer pageSize, Integer uid) |
| UserService.getUserDevices    | 前置条件 | 用户已登录并希望获取某用户设备列表                           |
|                               | 后置条件 | 系统返回该用户设备列表                                       |

<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                               |
| ------------------------------------------------------------ | ---------------------------------- |
| UserMapper.selectByPrimaryKey(Integer id)                    | 根据id在数据库中查找用户记录       |
| UserMapper.selectByEmail(String email)                       | 根据电子邮箱在数据库中查找用户信息 |
| UserMapper.insert(User record)                               | 在数据库中插入一条新的用户记录     |
| messageMapper.insert(message)                                | 插入新的推送消息                   |
| userDeviceMapper.insert(userDevice)                          | 插入新的用户设备记录               |
| userDeviceMapper.deleteByPrimaryKey(userDeviceRecordId)      | 删除某条用户设备记录               |
| userDeviceMapper.updateByPrimaryKey(new UserDevice(userDeviceVo)) | 更新某条用户设备记录               |
| userDeviceMapper.selectByUserId(uid)                         | 获得某用户的用户设备列表           |
|                                                              |                                    |

###### 业务逻辑层的动态模型

下图是用户注册时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220402100342420](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402100342420.png)

下图是用户登录时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304112933295](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304112933295.png)

#### 用户活跃度部分

##### `serviceImpl.activeness`

###### 模块概述

`serviceImpl.activeness`模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加`service.activeness.ActivenessService`接口。业务逻辑层和数据层之间添加`dao. activeness.ActivenessMapper`接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528215410534.png" alt="image-20220528215410534" style="zoom: 33%;" />

serviceimpl.activeness模块的类的职责

| 模块                   | 职责                                       |
| ---------------------- | ------------------------------------------ |
| serviceimpl.activeness | 负责实现用户活跃度各种指标的计算和获取功能 |



###### 模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）           |          |                                                              |
| ------------------------------ | -------- | ------------------------------------------------------------ |
|                                | 语法     | ResultVo\<List\<ActivenessVo>> updateAllWk();                |
| ActivenessService.updateAllWk  | 前置条件 | 管理员触发用户周活跃度更新操作                               |
|                                | 后置条件 | 数据库中更新用户周活跃度信息                                 |
|                                | 语法     | ResultVo\<ActivenessVo> getDetail(Integer uid);              |
| ActivenessService.getDetail    | 前置条件 | 获取用户详细活跃度信息                                       |
|                                | 后置条件 | 返回用户活跃度详细信息                                       |
|                                | 语法     | PageInfo\<ActivityDTO> getList(Integer uid, Integer page, Integer pageSize); |
| ActivenessService.getList      | 前置条件 | 分页查询用户活跃度信息                                       |
|                                | 后置条件 | 系统返回所有工人活跃度信息并分页展示                         |
|                                | 语法     | ResultVo\<List\<ActivenessVo>> updateAllMon();               |
| ActivenessService.updateAllMon | 前置条件 | 更新所有用户月活跃度信息                                     |
|                                | 后置条件 | 将用户月活跃度信息写入数据库                                 |

<center>需要的服务（需接口）</center>
| 服务名                                         | 服务                           |
| ---------------------------------------------- | ------------------------------ |
| ActivenessCalAsync.updateAllWk(Integer time);  | 异步更新所有用户周活跃度信息   |
| ActivenessMapper.selectByUserID(Long id);      | 查询用户活跃度信息             |
| ActivenessMapper.insert(Activeness);           | 增加一条用户活跃度记录         |
| ActivenessMapper.selectAll();                  | 查询所有用户活跃度信息         |
| UserMapper.selectByPrimaryKey(Long uid);       | 查询用户信息                   |
| ActivenessCalAsync.updateAllMon(Integer time); | 异步更新所有用户的月活跃度信息 |

###### 业务逻辑层的动态模型

下图是管理员触发用户周/月活跃度更新操作，业务逻辑处理对象和相关对象之间的协作。

![image-20220528215857865](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528215857865.png)

下图是用户查看个人活跃度信息操作业务逻辑处理对象和相关对象之间的协作。

![image-20220528215923485](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528215923485.png)

#### 用户能力部分

##### serviceImpl.usercapability

###### 模块概述

serviceImpl.usercapability模块承担的需求见需求规格说明文档功能需求以及相关非功能需求

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.usercapability.UserCapabilityService接口。业务逻辑层和数据层之间添加dao. usercapability.UserCapabilityMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceImpl.usercapability模块设计如图所示：

![image-20220528215954029](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528215954029.png)

serviceimpl.usercapability模块的类的职责

| 模块                       | 职责               |
| -------------------------- | ------------------ |
| serviceimpl.usercapability | 负责用户能力的获取 |

###### 模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                       |          |                                                     |
| ------------------------------------------ | -------- | --------------------------------------------------- |
|                                            | 语法     | ResultVo<UserCapabilityVo> getDetail(Integer uid);  |
| UserCapabilityService .getDetail           | 前置条件 | 用户获取个人能力信息                                |
|                                            | 后置条件 | 返回用户个人能力信息                                |
|                                            | 语法     | ResultVo<TypeVo> getTasksTypeByUserId(Integer uid); |
| UserCapabilityService.getTasksTypeByUserId | 前置条件 | 获取用户参与过的任务类型                            |
|                                            | 后置条件 | 返回该用户参与过的任务类型                          |



<center>需要的服务（需接口）</center>
| 服务名                                        | 服务                       |
| --------------------------------------------- | -------------------------- |
| UserCapabilityMapper.selectByUserId(Long uid) | 根据任务id查找用户能力属性 |
| UserCapabilityMapper.insert(userCapability);  | 存储用户能力属性信息       |
| TestRecordMapper.selectByUserId(Long uid)     | 根据用户id获取用户测试记录 |
| TaskMapper.selectByPrimaryKey(Long id)        | 根据任务编号查找任务       |

######  业务逻辑层的动态模型

下图是用户获取能力属性操作业务逻辑处理对象和相关对象之间的协作。

![image-20220528220041787](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220041787.png)

下图是用户获取参与过的任务的类型操作业务逻辑处理对象和相关对象之间的协作。

![image-20220528220054750](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220054750.png)

#### 任务部分

##### **serviceimpl.task**

###### 模块概述

serviceimpl.task模块承担的需求见需求规格说明文档功能需求以及相关非功能需求

**整体结构**

 根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.task.TaskService接口。业务逻辑层和数据层之间添加dao.task.TaskMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.task模块的设计如图所示。

![image-20220528221744379](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221744379.png)

serviceimpl.task模块的类的职责

| 模块             | 职责                                                         |
| ---------------- | ------------------------------------------------------------ |
| serviceimpl.task | 负责实现任务的发布任务，发包方查看自己发布的任务，任务广场查看正在招募的任务，工人接受任务，查看自己在做的任务，已完成的任务，管理员查看所有任务，查看任务详情、获取为某个任务推荐的用户 |



###### 模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                |          |                                                              |
| ----------------------------------- | -------- | ------------------------------------------------------------ |
|                                     | 语法     | PageInfo\<TaskVo> getTaskList(Integer currPage, int pageSize, int uid) |
| TaskService.getTaskList             | 前置条件 | 前端传递用户id和展示的页数                                   |
|                                     | 后置条件 | 返回任务广场正在招募的任务                                   |
|                                     | 语法     | ResultVO\<TaskVo> releaseTask(TaskVo taskVo)；               |
| TaskService.releaseTask             | 前置条件 | 发包方填写完整的任务描述                                     |
|                                     | 后置条件 | 数据库中插入一条记录                                         |
|                                     | 语法     | PageInfo\<TaskVo> getTasksByUid(Integer currPage, Integer pageSize, Integer uid)； |
| TaskService.getTasksByUid           | 前置条件 | 发包方已经登陆并且点击查看自己发布的任务按钮                 |
|                                     | 后置条件 | 返回该用户已发布的任务列表                                   |
|                                     | 语法     | PageInfo\<TaskVo> getTasksProcessingByuid(Integer currPage, Integer pageSize, Integer uid)； |
| TaskService.getTasksProcessingByuid | 前置条件 | 工人已完成登录并且点击查看自己在做的任务按钮                 |
|                                     | 后置条件 | 返回该工人正在做的任务列表                                   |
|                                     | 语法     | PageInfo\<TaskVo> getTasksHistoryByuid(Integer currPage, Integer pageSize, Integer uid) |
| TaskService.getTasksHistoryByuid    | 前置条件 | 工人已完成登录并点击已完成任务按钮                           |
|                                     | 后置条件 | 返回该工人已完成的任务列表                                   |
|                                     | 语法     | PageInfo\<TaskVo> getAll(Integer currPage, Integer pageSize,Integer uid) |
| TaskService.getAll                  | 前置条件 | 以管理员身份登录并且点击查看所有任务按钮                     |
|                                     | 后置条件 | 返回数据库中说有任务列表                                     |
|                                     | 语法     | ResultVO\<TestRecordVo> accept(TestRecordVo testRecordVo)    |
| TaskService.accept                  | 前置条件 | 工人登录并且选定一个正在招募的任务                           |
|                                     | 后置条件 | 向数据库中插入一条数据                                       |
|                                     | 语法     | ResultVO\<TaskVo> getDetail(Integer uid, Integer taskid)     |
| TaskService.getDetail               | 前置条件 | 已完成登录并且选定一个任务准备查看详情                       |
|                                     | 后置条件 | 返回该任务详情                                               |
|                                     | 语法     | ResultVo<TestRecordVo> getTestRecord(Integer uid, Integer testrecordid) |
| TaskService.getTestRecord           | 前置条件 | 选定一个测试记录                                             |
|                                     | 后置条件 | 返回测试记录详情                                             |
|                                     | 语法     | List<Integer> getRecommendations(Integer taskId)             |
| TaskService.getRecommendations      | 前置条件 | 发包方查看为某个任务推荐的众包工人                           |
|                                     | 后置条件 | 返回系统推荐的众包工人                                       |
|                                     | 语法     | ResultVo<TaskVo> closeTask(Integer taskId)                   |
| TaskService.closeTask               | 前置条件 | 发包方选择停止某个任务的招募                                 |
|                                     | 后置条件 | 该任务停止招募                                               |

<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                                   |
| ------------------------------------------------------------ | -------------------------------------- |
| TaskMapper.selectByPrimaryKey(Integer id)                    | 根据任务id查找任务                     |
| TaskMapper.selectAll()                                       | 查看所有任务                           |
| TaskMapper.insert(Task record)                               | 插入一条任务数据到数据库               |
| TaskMapper.selectByUid(Integer uid)                          | 根据用户id查找该用户参加的所有任务列表 |
| TaskMapper.selectProcessingByUid(Integer uid)                | 根据用户id查找该用户正在做的任务       |
| TaskMapper.selectHistoryByUid(Integer uid)                   | 根据用户id查找该用户已经完成的任务     |
| TaskMapper.todoList();                                       | 查看正在招募的任务                     |
| FileHelper.List\<FileInfoVo> save(String localPath, String destPath) | 存储前端传来的文件                     |
| SimilarityMeasure.cosinSimilarity(HashMap<String, Integer> vector1, HashMap<String, Integer> vector2) | 计算词向量的相似度                     |
| UserDescriptorMapper.selectAll()                             | 获取用户的描述性词                     |
| TestRecordMapper.insert(TestRecord testRecord)               | 插入一条测试记录                       |
| TaskDescriptorMapper.selectByTaskid(Integer taskId)          | 获取任务的描述性词                     |
| ActivenessMapper.selectByUserID(Long uid)                    | 获取用户活跃信息                       |



######  业务逻辑层的动态模型

下图是发包方发布任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113307242](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113307242.png)

下图是发包方查看自己发布的任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113336910](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113336910.png)

下图是任务广场查看正在招募的任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113410472](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113410472.png)

下图是工人查看自己在做的任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113505512](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113505512.png)

下图是工人查看自己已完成的任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113529694](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113529694.png)

下图是管理员查看所有任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113632463](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113632463.png)

下图是工人接受任务时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113610895](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113610895.png)

下图是查看任务详情时，用户业务逻辑处理对象与相关对象之间的协作。

![image-20220304113551972](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220304113551972.png)

下图是发包方获取为某个任务推荐的用户时，任务业务逻辑处理对象与相关对象之间的协作。

![image-20220528221723402](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221723402.png)

#### 任务评价部分

##### serviceimpl.taskRatings, service.taskRatings

###### 模块概述

serviceimpl.taskRatings模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.taskRatings.TaskRatingsService接口。业务逻辑层和数据层之间添加dao.taskRatings.TaskRatingsMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.taskRatings模块的设计如图所示。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221331290.png" alt="image-20220528221331290" style="zoom:33%;" />

serviceimpl.taskRatings模块的职责

| 模块                    | 职责                                                         |
| ----------------------- | ------------------------------------------------------------ |
| serviceimpl.taskRatings | 负责实现允许用户发表对任务的评价、提供某任务的评价列表和某用户的评价列表、负责获取报告的打分均分 |

###### 模块内部类的接口规范



<center>提供的服务（供接口）</center>
| 提供的服务（供接口）              |          |                                                              |
| --------------------------------- | -------- | ------------------------------------------------------------ |
|                                   | 语法     | ResultVo\<TaskRatingsVo> rank(TaskRatingsVo taskRatingsVo)   |
| TaskRatingsService.rank           | 前置条件 | 众包工人用户已接下该任务                                     |
|                                   | 后置条件 | 系统将任务评价持久到数据库并返回结果                         |
|                                   | 语法     | PageInfo\<TaskRatingsVo> getRatings(Integer currPage, Integer pageSize, Integer uid) |
| TaskRatingsService.getRatings     | 前置条件 | 用户分页获得某用户的评价列表                                 |
|                                   | 后置条件 | 系统返回用户对应的评价列表                                   |
|                                   | 语法     | PageInfo\<TaskRatingsVo> getTaskRatings(Integer currPage, Integer pageSize, Integer uid, Integer taskid) |
| TaskRatingsService.getTaskRatings | 前置条件 | 用户分页获得某任务的评价列表                                 |
|                                   | 后置条件 | 系统返回任务对应的评价列表                                   |

| 提供的服务（供接口）                |          |                                                              |
| ----------------------------------- | -------- | ------------------------------------------------------------ |
|                                     | 语法     | ResultVo\<Double> getTaskRatingPer(Integer uid, Integer taskid); |
| TaskRatingsService.getTaskRatingPer | 前置条件 | 获取此任务的打分均分                                         |
|                                     | 后置条件 | 返回此任务打分均分                                           |




<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                                         |
| ------------------------------------------------------------ | -------------------------------------------- |
| taskRatingsMapper.selectByPrimaryKey(taskRatings.getUserId(), taskRatings.getTaskId()) | 根据用户ID和任务ID联合主键获得对应的任务评价 |
| taskRatingsMapper.insert(taskRatings)                        | 发布新的任务评价                             |
| taskRatingsMapper.selectByUid((long) uid)                    | 获取某用户的任务评价                         |
| taskRatingsMapper.selectByTaskId((long) taskid)              | 获得某任务的任务评价                         |

| 服务名                                    | 服务                                 |
| ----------------------------------------- | ------------------------------------ |
| taskRatingsMapper.selectByTaskId(Long id) | 根据任务id找到这个任务的所有打分信息 |

######  业务逻辑层的动态模型

下图是发布报告评价时，任务评价逻辑处理对象与相关对象之间的协作。

由于一个用户只能发对一份任务评价一次，因此再次发布会变成更新。

![image-20220402102132970](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402102132970.png)

下图是获取某任务的评价时，任务评价逻辑处理对象与相关对象之间的协作。

![image-20220402102822705](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402102822705.png)

下图是获取获取任务的均分时，任务评价逻辑处理对象与相关对象之间的协作。

![image-20220528220601820](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220601820.png)

#### 任务推荐部分

##### serviceimpl.recommend

###### 模块概述

serviceimpl.recommend模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.recommend.RecommendTaskService接口。业务逻辑层和数据层之间添加dao.task.TaskMapper以及dao.task.TestRecordMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

==关于推荐算法的介绍请查看`README.md`==

serviceimpl.recommend模块的设计如图所示。

![image-20220401090756613](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401090756613.png)

serviceimpl.recommend模块的职责

| 模块                  | 职责                                                         |
| --------------------- | ------------------------------------------------------------ |
| serviceimpl.recommend | 负责实现向用户推荐任务、允许管理员查看推荐规则、切换任务规则、修改任务规则 |



###### 模块内部类的接口规范


<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                    |          |                                                              |
| --------------------------------------- | -------- | ------------------------------------------------------------ |
|                                         | 语法     | ResultVo<List\<TaskVo>> getRecommendations(Integer uid)      |
| RecommendTaskService.getRecommendations | 前置条件 | 前端传入待推荐任务的用户id                                   |
|                                         | 后置条件 | 计算并返回推荐给该用户的任务                                 |
|                                         | 语法     | ResultVo\<TaskRecommendStrategyDTO> changeStrategy(Integer strategyId); |
| RecommendTaskService.changeStrategy     | 前置条件 | 前端传入要切换的策略id                                       |
|                                         | 后置条件 | 修改原先启用的策略为关闭状态，并启用指定策略id的推荐策略     |
|                                         | 语法     | ResultVo\<TaskRecommendStrategyDTO> modifyStrategy(Map<String, Double> config, Integer strategyId, Integer N); |
| RecommendTaskService.modifyStrategy     | 前置条件 | 传入策略配置，待修改的策略id，修改后的推荐的任务报告数       |
|                                         | 后置条件 | 将修改后的策略持久化保存到磁盘上的指定文件中                 |
|                                         | 语法     | ResultVo<List\<TaskRecommendStrategyDTO>> getStrategies();   |
| RecommendTaskService.getStrategies      | 前置条件 | 前端发起查看所有策略的请求                                   |
|                                         | 后置条件 | 返回所有的推荐策略                                           |


<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                         |
| ------------------------------------------------------------ | ---------------------------- |
| TaskRecommendStrategy.recommend(Integer uid)                 | 获取推荐的任务               |
| TaskRecommendStrategy.getStrategyId()                        | 获取策略对应的id             |
| TaskRecommendStrategy.modify(HashMap<String, Double> newConfig, Integer N) | 修改策略并持久化保存到磁盘上 |



###### 业务逻辑层的动态模型

下图是用户获取推荐任务时，推荐任务逻辑处理对象与相关对象之间的协作。

![image-20220401090952047](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401090952047.png)

下图是用户修改策略时，推荐任务逻辑处理对象与相关对象之间的协作。

![image-20220401091013472](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401091013472.png)



#### 缺陷报告部分

##### serviceimpl.defectReport

###### 模块概述

serviceimpl.defectReport模块承担的需求见需求规格说明文档功能需求以及相关非功能需求

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.defectReport.defectReportService接口。业务逻辑层和数据层之间添加dao.defectReport.DefectReportMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.defectReport模块的设计如图所示。

![image-20220528221227614](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221227614.png)

serviceimpl.defectReport模块的类的职责。

| 模块                     | 职责                                                         |
| ------------------------ | ------------------------------------------------------------ |
| serviceimpl.defectReport | 众包工人在线填写众测报告、发包方浏览自身发布的某一众测任务的报告、获取众测报告详情、负责获取报告的评审，对报告进行聚类以及对报告提取关键词以及关键词的词频 |



###### 模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                        |          |                                                              |
| ------------------------------------------- | -------- | ------------------------------------------------------------ |
|                                             | 语法     | ResultVo\<DefectReportVo> getDetail(Integer uid, Integer defectReportId) |
| defectReportService.getDetail               | 前置条件 | 前端传递用户id和对应缺陷报告ID                               |
|                                             | 后置条件 | 返回该缺陷报告详情                                           |
|                                             | 语法     | ResultVo\<DefectReportVo> releaseDefectReport(DefectReportVo defectReportVo, MultipartFile[] files) |
| defectReportServiceImpl.releaseDefectReport | 前置条件 | 前端众测工人传入缺陷报告内容及其包含的截图文件               |
|                                             | 后置条件 | 数据库中插入一条记录、文件存储到服务器本地和腾讯云对象存储COS中 |
|                                             | 语法     | PageInfo\<DefectReportVo> getReportsByTaskid(Integer currPage, Integer pageSize, Integer uid, Integer taskid) |
| defectReportServiceImpl.getReportsByTaskid  | 前置条件 | 前端发包方传入用户id和任务id                                 |
|                                             | 后置条件 | 返回该任务对应的缺陷报告列表                                 |

| 提供的服务（供接口）                             |          |                                                              |
| ------------------------------------------------ | -------- | ------------------------------------------------------------ |
|                                                  | 语法     | ResultVo\<DefectReportVo> reviewDefectReport(ReportReviewVo reportReviewVo); |
| defectReportService.reviewDefectReport           | 前置条件 | 发包方对用户提交的报告进行评审                               |
|                                                  | 后置条件 | 将评审信息存入数据库                                         |
|                                                  | 语法     | ResultVo\<ReportReviewVo> getReviewByReportId(Integer reportId) |
| defectReportService.getReviewByReportId          | 前置条件 | 获取评审信息                                                 |
|                                                  | 后置条件 | 返回这条报告的评审信息详情                                   |
|                                                  | 语法     | PageInfo\<DefectReportVo> getLowQualityReportsByTaskid(Integer page, Integer pageSize, Integer taskId); |
| defectReportService.getLowQualityReportsByTaskid | 前置条件 | 查询该任务下的低质量报告                                     |
|                                                  | 后置条件 | 分页返回低质量报告                                           |
|                                                  | 语法     | ResultVo\<List\<ClusterVo>> getKMeans(Integer uid, Integer k, Integer keyword) ； |
| defectReportService.getKMeans                    | 前置条件 | 用户查询自己的报告聚类词云结果                               |
|                                                  | 后置条件 | 返回聚类后的报告的关键词词云词频                             |
|                                                  | 语法     | ResultVo\<List\<ClusterVo>> getWorkerKMeans(Integer uid, Integer k, Integer keyword, Integer taskid) ； |
| defectReportService.getWorkerKMeans              | 前置条件 | 查询某个任务下的报告聚类结果                                 |
|                                                  | 后置条件 | 返回聚类后的报告详情以及每个类报告的关键词词频词云           |



<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                                             |
| ------------------------------------------------------------ | ------------------------------------------------ |
| DefectReport.insert(DefectReport record);                    | 向数据库中插入缺陷报告记录                       |
| DefectReport.selectByTestRecordId(Integer testRecordId)      | 根据测试记录id（特定的人和特定任务）查找缺陷报告 |
| DefectReport.selectByTaskId(Integer taskId)                  | 根据任务id查找对应的缺陷报告                     |
| DefectReport.selectByPrimaryKey(Integer id)                  | 根据缺陷报告id（主键）查找对应缺陷报告           |
| FileHelper.List\<FileInfoVo> save(String path, MultipartFile[] files) | 存储前端传来的文件                               |
| COSUtil.uploadObject(String localPath, String destPath)      | 把本地存好的文件同步到腾讯云COS上                |

| 服务名                                                  | 服务                       |
| ------------------------------------------------------- | -------------------------- |
| defectReportMapper.selectByTaskId（Long id）            | 根据任务id找到报告         |
| remarkMapper.selectByReportId（Long id）                | 根据报告id找到打分信息     |
| userCapabilityMapper.selectByUserId(Long uid)           | 根据用户id找到用户能力信息 |
| userCapabilityMapper.insert(UserCapability)             | 新增用户能力信息           |
| userCapabilityMapper.updateByPrimaryKey(userCapability) | 更新用户能力信息           |
| reportReviewMapper.selectByPrimaryKey(Long id)          | 找到报告评审记录           |
| reportReviewMapper.updateByPrimaryKey(reportReview)     | 更新报告评审信息           |
| reportReviewMapper.insert(reportReview)                 | 新增报告评审信息           |
| activenessMapper.selectByUserID(Long uid)               | 查找用户活跃度信息         |
| messageMapper.insert(message)                           | 新增消息记录               |
| defectReportMapper.updateByPrimaryKey(defectReport)     | 更新报告                   |
| userMapper.updateByPrimaryKey(user)                     | 更新用户信息               |
| reportDescriptorMapper.selectByReportId(Long id)        | 获取报告描述信息           |
| userDescriptorMapper.selectByUid(Long uid)              | 获取用户描述信息           |
| userDescriptorMapper.updateByPrimaryKey(userDescriptor) | 更新用户描述信息           |
| defectReportMapper.selectByTestRecordId(Long id)        | 根据测试记录获取报告信息   |

######  业务逻辑层的动态模型

下图是众测工人发布报告时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220402113122617](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402113122617.png)

下图是发包方浏览自身发布的某一众测任务的报告时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220402110708983](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402110708983.png)

下图是发包方对用户提交的报告进行评审时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220528220744066](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220744066.png)

下图是获取评审信息时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220528220803004](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220803004.png)

下图是查询该任务下的低质量报告时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220528221038509](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221038509.png)

下图是查询用户查询自己的报告聚类词云结果时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220528220831570](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220831570.png)

下图是查询某个任务下的报告聚类结果时，缺陷报告业务逻辑处理对象与相关对象之间的协作。

![image-20220528220852411](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220852411.png)



#### 补充报告部分

##### serviceimpl.additionalReport

###### 模块概述

service.additionalReport模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.additionalReport.AdditionalReportService接口。业务逻辑层和数据层之间添加dao.additionalReport.AdditionalReportMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.additionalReport模块的设计如图所示。

![image-20220401093036348](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401093036348.png)

serviceimpl.additionalReport模块的类的职责如下。

| 模块                         | 职责                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| serviceimpl.additionalReport | 负责实现允许用户发表对缺陷报告的补充报告、提供某缺陷报告的补充报告列表 |

###### 模块内部类的接口规范



<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                                         |          |                                                              |
| ------------------------------------------------------------ | -------- | ------------------------------------------------------------ |
|                                                              | 语法     | ResultVo\<AdditionalReportVo> releaseAdditionalReport(AdditionalReportVo additionalReportVo, MultipartFile[] files) |
| AdditionalReportService.releaseAdditionalReport              | 前置条件 | 用户主动协作该缺陷报告                                       |
|                                                              | 后置条件 | 系统将新的补充报告持久化并返回操作结果                       |
|                                                              | 语法     | ResultVo\<AdditionalReportVo> getDetail(Integer uid, Integer additionalReportId) |
| AdditionalReportService.getDetail                            | 前置条件 | 该补充报告存在                                               |
|                                                              | 后置条件 | 系统返回对应的补充报告详情                                   |
|                                                              | 语法     | PageInfo\<AdditionalReportVo> getAdditionalReportsByReportId(Integer currPage, Integer pageSize, Integer uid, Integer defectReportId) |
| AdditionalReportService.getAdditionalReportsByReportId       | 前置条件 | 用户获取某缺陷报告的补充报告                                 |
|                                                              | 后置条件 | 系统返回对应的补充报告列表                                   |
|                                                              | 语法     | PageInfo\<AdditionalReportVo> getAdditionalReportsByReportIdAndUid(Integer currPage, Integer pageSize, Integer uid, Integer defectReportId) |
| AdditionalReportService.getAdditionalReportsByReportIdAndUid | 前置条件 | 用户获取某用户在某报告下发布的所有补充报告                   |
|                                                              | 后置条件 | 系统返回对应的补充报告列表                                   |




<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                                     |
| ------------------------------------------------------------ | ---------------------------------------- |
| FileHelper.save(filePath + curTimeMillis + '/', files)       | 将文件先存储到本地                       |
| COSUtil.uploadObject(filePath + localPath, "/upload/" + localPath) | 把文件上传到对象存储中                   |
| additionalReportMapper.insert(additionalReport)              | 插入新的补充报告                         |
| additionalReportMapper.selectByPrimaryKey((long) additionalReportId) | 根据主键筛选补充报告                     |
| additionalReportMapper.selectByReportId((long) defectReportId) | 根据缺陷报告获得对应的补充报告列表       |
| additionalReportMapper.selectByReportIdAndUserId((long) defectReportId, uid.longValue()) | 根据缺陷报告和用户获得对应的补充报告列表 |



######  业务逻辑层的动态模型

下图是发布补充报告时，补充评价业务逻辑处理对象与相关对象之间的协作。

![image-20220402105509790](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402105509790.png)

下图是根据缺陷报告获得对应的补充报告列表时，补充评价业务逻辑处理对象与相关对象之间的协作。

![image-20220402111041942](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402111041942.png)

#### 报告评价部分

##### serviceimpl.remark

###### 模块概述

serviceimpl.remark模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.remark.RemarkService接口。业务逻辑层和数据层之间添加dao.remark.RemarkMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.remark模块的设计如图所示。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528221429309.png" alt="image-20220528221429309" style="zoom:50%;" />

serviceimpl.remark模块的职责如下。

| 模块               | 职责                                                         |
| ------------------ | ------------------------------------------------------------ |
| serviceimpl.remark | 负责实现允许用户发表对缺陷报告的评价、提供某缺陷报告的评价列表 |



###### 新增模块内部类的接口规范

<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                  |          |                                                              |
| ------------------------------------- | -------- | ------------------------------------------------------------ |
|                                       | 语法     | ResultVo\<RemarkVo> releaseRemark(RemarkVo remarkVo, Integer uid) |
| RemarkService.releaseRemark           | 前置条件 | 前端提交报告评价                                             |
|                                       | 后置条件 | 将报告评价存入数据库中并返回结果                             |
|                                       | 语法     | PageInfo\<RemarkVo> getRemarksByReportId(Integer currPage, Integer pageSize, Integer defectReportId, Integer uid) |
| RemarkService.getRemarksByReportId    | 前置条件 | 前端传入缺陷报告的ID                                         |
|                                       | 后置条件 | 返回该缺陷报告对应的评价列表                                 |
|                                       | 语法     | ResultVo\<Double> getAvgRemarkByReportId(Integer uid, Integer reportid); |
| RemarkService .getAvgRemarkByReportId | 前置条件 | 用户获取别人给自己报告打的平均分信息                         |
|                                       | 后置条件 | 返回用户报告均分信息                                         |




<center>需要的服务（需接口）</center>
| 服务名                                        | 服务                                 |
| --------------------------------------------- | ------------------------------------ |
| remarkMapper.insert(remark)                   | 插入新报告评价                       |
| remarkMapper.selectByReportId(defectReportId) | 根据缺陷报告id获得对应的报告评价列表 |
| remarkMapper.selectByReportId(Long id)        | 根据报告id找到这条报告的所有打分信息 |



######  业务逻辑层的动态模型

下图是发布报告评价时，报告评价业务逻辑处理对象与相关对象之间的协作。

![image-20220401162255437](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401162255437.png)

下图是获得某一报告下对应的报告评价时，报告评价业务逻辑处理对象与相关对象之间的协作。

![image-20220401162231550](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401162231550.png)

下图是获取报告的众包工人均分时，报告评价业务逻辑处理对象与相关对象之间的协作。

![image-20220528220140769](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220528220140769.png)

#### 报告相似度部分

##### `similarity.similarityService`

###### 模块概述

`similarity.similarityService`模块承担的需求见需求规格说明文档功能需求以及相关非功能需求

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加`service.similarity.SimilarityService`接口。业务逻辑层和数据层之间添加`dao.similarity.SimilarityMapper`接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

==关于报告相似度检测部分的算法说明，详见`README.md`==。

`similarity.similarityService`模块的设计如图所示。

![image-20220330165728688](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220330165728688.png)

`similarity.similarityService`模块的类的职责

| 模块                         | 职责                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| similarity.similarityService | 负责实现缺陷报告和所属任务的其他缺陷报告的相似度计算，相似报告协作推荐的功能。 |



###### 模块内部类的接口规范



<center>提供的服务（供接口）</center>
| 提供的服务（供接口）               |          |                                                              |
| ---------------------------------- | -------- | ------------------------------------------------------------ |
|                                    | 语法     | void CalSim(DefectReport defectReport);                      |
| SimilarityService.CalSim           | 前置条件 | 前端提交缺陷报告                                             |
|                                    | 后置条件 | 将该缺陷报告与数据库里同一任务的报告计算相似度，如果相似度超过某个阈值，将该报告拒绝，否则将其他相似报告推荐给该用户进行协作 |
|                                    | 语法     | ResultVo\<List \<AuditDetailsVo>> findAuditDetails(Integer reportId, Integer topN); |
| SimilarityService.findAuditDetails | 前置条件 | 前端传入待推荐报告的id和推荐的数量                           |
|                                    | 后置条件 | 返回带有评分的报告的列表                                     |
|                                    | 语法     | ResultVo\<SimilarityConfigVo> getLimit(@RequestParam Integer uid) |
| SimilarityService.setLimit         | 前置条件 | 发出该请求的用户是管理员                                     |
|                                    | 后置条件 | 系统返回设置结果                                             |
|                                    | 语法     | ResultVo\<SimilarityConfigVo> setLimit(SimilarityConfigVo similarityConfigVo,                                       Integer uid) |
| SimilarityService.getLimit         | 前置条件 | 发出该请求的用户是管理员                                     |
|                                    | 后置条件 | 系统返回设定的阈值                                           |

还有一个重要的异步方法，`calSim`，被`defectReportServiceImpl`调用，不对前端服务。相关顺序图中已有明确说明。

```java
public void calSim(DefectReport defectReport)
```




<center>需要的服务（需接口）</center>
| 服务名                                                       | 服务                         |
| ------------------------------------------------------------ | ---------------------------- |
| TestRecordMapper.selectByPrimaryKey(int id)                  | 根据测试报告id查找测试报告   |
| DefectReportMapper.selectByTaskId(int id)                    | 根据测试报告id查找缺陷报告   |
| SimilarityMapper.selectByReportId(int id)                    | 根据缺陷报告id查找相似度记录 |
| DefectReportMapper.updateByPrimaryKey(DefectReport defectreport) | 更新缺陷报告状态             |
| SimilarityMapper.insert(Similarity Similarity)               | 向相似度表中插入相似度记录   |
| DefectReportMapper.selectByPrimaryKey(int id)                | 根据id查找缺陷报告           |



######  业务逻辑层的动态模型

下图展示了获取相似报告（根据阈值`reommend`筛选或不根据阈值筛选`findAuditDetails`）时，相似度报告业务逻辑处理对象与相关对象之间的协作。

![image-20220401092632574](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401092632574.png)

 下图展示了设置相似度报告阈值时，相似度报告业务逻辑处理对象与相关对象之间的协作。

![image-20220402161313334](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402161313334.png)

下图展示了获取相似度报告阈值时，相似度报告业务逻辑处理对象和相关对象之间的协作。

![image-20220402161409013](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220402161409013.png)

#### 消息部分

##### serviceimpl.message

###### 模块概述

serviceimpl.message模块承担的需求见需求规格说明文档功能需求以及相关非功能需求。

###### 整体结构

根据体系结构的设计，我们采用分层的风格来构建本系统。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加service.message.MessageService接口。业务逻辑层和数据层之间添加dao.message.MessageMapper接口。这样，我们将依赖于接口而非实体类，增加了系统的灵活性。

serviceimpl.message模块的设计如图所示。

![image-20220401092534511](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401092534511.png)

serviceimpl.message模块的职责如下。

| 模块                | 职责                           |
| ------------------- | ------------------------------ |
| serviceimpl.message | 负责实现允许用户查看推送的消息 |

###### 模块内部类的接口规范



<center>提供的服务（供接口）</center>
| 提供的服务（供接口）                 |          |                                                              |
| ------------------------------------ | -------- | ------------------------------------------------------------ |
|                                      | 语法     | PageInfo\<MessageVo>getMessageByUserId(Integer currPage, Integer pageSize, Integer uid) |
| MessageService.getMessageByUserId    | 前置条件 | 用户已登录                                                   |
|                                      | 后置条件 | 返回该用户所有消息                                           |
|                                      | 语法     | PageInfo\<MessageVo> getNewMessageByUserId(Integer currPage, Integer pageSize, Integer uid) |
| MessageService.getNewMessageByUserId | 前置条件 | 用户已登录                                                   |
|                                      | 后置条件 | 返回该用户所有未读消息                                       |
|                                      | 语法     | ResultVo\<MessageVo> setRead(Long messageid, Long uid)       |
| MessageService.setRead               | 前置条件 | 用户已登录且有未读的消息                                     |
|                                      | 后置条件 | 返回设置结果                                                 |




<center>需要的服务（需接口）</center>
| 服务名                                    | 服务                 |
| ----------------------------------------- | -------------------- |
| messageMapper.selectByUserId(uid)         | 根据用户筛选消息     |
| messageMapper.selectNewByUserId(uid)      | 根据用户筛选未读消息 |
| messageMapper.updateByPrimaryKey(message) | 根据主键更新消息     |



######  业务逻辑层的动态模型

下图是用户获得所有消息时，消息业务逻辑处理对象与相关对象之间的协作。获得未读消息的过程同理。

![image-20220401094539279](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401094539279.png)

下图是用户设置消息已读时，消息业务逻辑处理对象与相关对象之间的协作。

![image-20220401095043746](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220401095043746.png)



### 数据层分解

在业务逻辑到数据层层间接口上，我们使用了MyBatis来减少工作量。绝大部分的方法由MyBatis自动生成。业务逻辑层调用Mapper层的接口，而后再转化为对数据库的真实访问。

#### 用户部分

##### int deleteByPrimaryKey(Integer id);

根据主键（用户id）删除用户。

##### int insert(User record);

插入新的用户记录。

##### User selectByPrimaryKey(Integer id);

根据主键（用户id）获得某个用户。

##### List\<User> selectAll();

获得所有用户。

##### int updateByPrimaryKey(User record);

根据主键（用户id）更新某个用户。

##### User selectByEmail(String email);

根据邮件地址（唯一）获得某个用户。

#### 用户设备部分

##### int deleteByPrimaryKey(Long id);

根据主键删除某用户设备记录。

##### int insert(UserDevice record);

插入一条新的用户设备记录。

##### UserDevice selectByPrimaryKey(Long id);

根据主键获得某条用户设备记录。

##### List\<UserDevice> selectAll();

获得所有用户设备记录。

##### int updateByPrimaryKey(UserDevice record);

更新某条用户设备记录。

##### List\<UserDevice> selectByUserId(Integer userId);

获取某一用户的设备记录。

#### 任务部分

##### int deleteByPrimaryKey(Integer id);

根据任务id（主键）删除任务。

##### int insert(Task record);

插入任务。

##### Task selectByPrimaryKey(Integer id);

根据主键（任务id）查找任务。

##### List\<Task> selectAll();

分页，获得所有任务。

##### int updateByPrimaryKey(Task record);

根据主键（任务id）更新任务。

##### List\<Task> selectByUid(Integer uid);

分页，根据用户id查找任务。

##### List\<Task> selectProcessingByUid(Integer uid);

分页，根据用户id查找其已承接但仍未完成的任务。

##### List\<Task> selectHistoryByUid(Integer uid);

分页，根据用户id查找其已承接且已完成的任务。

##### List\<Task> todoList();

分页，查找所有正在招募的任务。

#### 测试记录部分

##### int insert(TestRecord record);

新增测试记录（某众测工人接下某项任务）

##### List\<TestRecord> selectAll();

分页，查找系统中所有测试记录。

##### List\<TestRecord> selectByPrimaryKey(Integer id);

分页，根据主键（测试记录id）查找测试记录。

##### int deleteByPrimaryKey(Integer id);

根据主键（测试记录id）删除测试记录。

##### List\<TestRecord> selectByTaskIdAndUid(Integer taskid, Integer uid);

分页，根据众测工人用户id和任务id查找对应测试记录。

##### int updateByPrimaryKey(Integer id, Integer taskId, Integer userId, Boolean finished, Date commitTime, Date finishTime);

根据主键（测试记录id）更新测试记录。

#### 缺陷报告部分

##### int insert(DefectReport record);

插入新缺陷报告。

##### List\<DefectReport> selectAll();

分页，查找系统中所有的缺陷报告。

##### List\<DefectReport> selectByTestRecordId(Integer testRecordId);

分页，根据测试记录ID查找对应的缺陷报告。

##### int deleteByPrimaryKey(Integer id);

根据缺陷报告ID（主键）删除缺陷报告。

##### List\<DefectReport> selectByTaskId(Integer taskId);

分页，根据任务ID查找该任务下对应缺陷报告。

##### List\<DefectReport> selectByPrimaryKey(Integer id);

分页，根据缺陷报告ID（主键）查找缺陷报告。

#### 补充报告部分

##### int deleteByPrimaryKey(Long id);

根据主键删除某条补充报告。

##### int insert(AdditionalReport record);

插入一条新的补充报告。

##### AdditionalReport selectByPrimaryKey(Long id);

根据主键获得某条缺陷报告。

##### List\<AdditionalReport> selectAll();

获得所有的缺陷报告。

##### int updateByPrimaryKey(AdditionalReport record);

更新某条用户设备记录。

##### List\<AdditionalReport> selectByReportId(Long defectReportId);

获取某一缺陷报告对应的补充报告列表。

#### 报告评价部分

##### int deleteByPrimaryKey(@Param("userId") Long userId, @Param("defectReportId") Long defectReportId);

根据主键（用户ID和缺陷报告ID联合主键）删除某条报告评价。

##### int insert(Remark record);

插入一条新的报告评价。

##### Remark selectByPrimaryKey(@Param("userId") Long userId, @Param("defectReportId") Long defectReportId);

根据主键（用户ID和缺陷报告ID联合主键）获得某条报告评价。

##### List\<Remark> selectAll();

获得所有报告评价。

##### int updateByPrimaryKey(Remark record);

更新某条报告评价。

##### List\<Remark> selectByReportId(Long defectReportId);

查找某条缺陷报告对应的报告评价。

#### 报告相似度部分

##### **int deleteByPrimaryKey(Long id);**

根据主键删除相似度记录数据。

##### **int insert(Similarity record);**

向数据库中插入相似度记录。

##### **Similarity selectByPrimaryKey(Long id);**

根据主键查找相似度记录。

##### **List\<Similarity> selectAll();**

查询所有相似度记录。

##### **int updateByPrimaryKey(Similarity record);**

根据主键更新相似度记录表。

##### **List\<Similarity> selectByReportId(Long reportid);**

根据报告id查询相似度记录。

#### 任务评价部分

##### int deleteByPrimaryKey(@Param("userId") Long userId, @Param("taskId") Long taskId);

根据主键（用户ID和任务ID联合主键）删除某条任务评价。

##### int insert(TaskRatings record);

插入一条新的用户评价。

##### TaskRatings selectByPrimaryKey(@Param("userId") Long userId, @Param("taskId") Long taskId);

根据主键（用户ID和任务ID联合主键）查找某条任务评价。

##### List\<TaskRatings> selectAll();

获得所有用户评价。

##### int updateByPrimaryKey(TaskRatings record);

更新某条人物评价。

##### List\<TaskRatings> selectByUid(@Param("userId") Long userId);

获得某一位用户对任务的评价。

#### 消息部分

##### int deleteByPrimaryKey(Long id);

根据主键删除某条消息。

##### int insert(Message record);

插入一条新的消息记录。

##### Message selectByPrimaryKey(Long id);

根据主键筛选消息。

##### List\<Message> selectAll();

获得系统中所有消息。

##### int updateByPrimaryKey(Message record);

更新某条消息。

##### List\<Message> selectByUserId(Long userId);

获取某位用户所有的消息。

##### List\<Message> selectNewByUserId(Long userId);

获取某位用户的未读消息。

在业务逻辑到数据层层间接口上，我们使用了MyBatis来减少工作量。绝大部分的方法由MyBatis自动生成。业务逻辑层调用Mapper层的接口，而后再转化为对数据库的真实访问。

#### 用户活跃度部分

```java
//删除活跃度信息
int deleteByPrimaryKey(Long id);
//插入一条信息
int insert(Activeness record);
//查询用户活跃度信息
Activeness selectByPrimaryKey(Long id);
//查询所有用户活跃度信息
List<Activeness> selectAll();
//更新用户活跃度信息
int updateByPrimaryKey(Activeness record);
//查询用户活跃度信息
Activeness selectByUserID(Long uid);
```

#### 用户能力部分

```java
// 删除一条用户能力信息
int deleteByPrimaryKey(Long id);
// 插入一条用户能力信息
int insert(UserCapability record);
// 查看一条用户能力信息
UserCapability selectByPrimaryKey(Long id);
// 删除所有用户能力信息
List<UserCapability> selectAll();
// 更新一条用户能力信息
int updateByPrimaryKey(UserCapability record);
// 查看一条用户能力信息
UserCapability selectByUserId(Long uid)
```

#### 报告评审部分

```java
// 删除一条评审记录
int deleteByPrimaryKey(Long id);
// 插入一条评审记录
int insert(ReportReview record);
// 选取一条评审记录
ReportReview selectByPrimaryKey(Long id);
// 查询所有评审记录
List<ReportReview> selectAll();
// 更新一条评审记录
int updateByPrimaryKey(ReportReview record);
// 根据报告ID查询一条评审记录
List<ReportReview> selectByReportId(Long reportid);
```

#### 重复报告记录部分

```java
// 删除一条重复BUG报告记录
int deleteByPrimaryKey(Integer id);
// 插入一条重复BUG报告记录
int insert(DupBug record);
// 根据主键获得重复BUG报告记录
DupBug selectByPrimaryKey(Integer id);
// 获取所有重复报告记录
List<DupBug> selectAll();
// 根据主键更新重复报告记录
int updateByPrimaryKey(DupBug record);
// 检索某一个报告对应的重复报告记录
DupBug selectByReportid(Integer reportId);
```

#### 报告描述性词部分

```java
// 根据主键删除对应记录
int deleteByPrimaryKey(Integer id);
// 插入一条新纪录
int insert(ReportDescriptor record);
// 根据主键获取对应记录
ReportDescriptor selectByPrimaryKey(Integer id);
// 获得所有记录
List<ReportDescriptor> selectAll();
// 更新某一条记录
int updateByPrimaryKey(ReportDescriptor record);
// 查找某报告的报告描述性词记录
ReportDescriptor selectByReportId(Integer reportId);
```

#### 任务描述性词部分

```java
// 根据主键删除对应记录
int deleteByPrimaryKey(Long id);
// 插入一条新纪录
int insert(TaskDescriptor record);
// 根据主键获取对应记录
TaskDescriptor selectByPrimaryKey(Long id);
// 获得所有记录
List<TaskDescriptor> selectAll();
// 更新某一条记录
int updateByPrimaryKey(TaskDescriptor record);
// 查找某任务的任务描述性词记录
String selectByTaskid(Integer taskId);
```

#### 用户描述性词部分

```java
// 根据主键删除对应用户描述性词记录
int deleteByPrimaryKey(Long id);
// 插入一条新的用户描述性词记录
int insert(UserDescriptor record);
// 根据主键获得一条用户描述性词记录
UserDescriptor selectByPrimaryKey(Long id);
// 获得全部用户描述性词记录
List<UserDescriptor> selectAll();
// 更新某一条记录
int updateByPrimaryKey(UserDescriptor record);
// 查找某用户的用户描述性词记录
UserDescriptor selectByUid(Integer userId);
```

### 数据库具体设计

#### `defect_report` 缺陷报告表

##### 用途

存储测试工人提交的缺陷报告。

##### 结构

```mysql
CREATE TABLE `defect_report` (
  `id` bigint UNSIGNED NOT NULL,
  `test_record_id` bigint NOT NULL,
  `screenshot_path_list` text NOT NULL,
  `description` text NOT NULL,
  `title` varchar(128) NOT NULL DEFAULT 'title',
  `operating_system` enum('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `device_brand` enum('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER') CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `create_time` datetime NOT NULL,
  `status` enum('PENDING','PROCESSING','PASSED','REJECTED') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 缺陷报告id

`test_record_id` 对应测试报告id

`screenshot_path_list` 截图路径列表

`description` 描述内容

`operating_system` 设备对应操作系统类型 ('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') 

`device_brand` 设备品牌 ('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER')

`create_time` 缺陷报告发布时间

`status` 报告状态，分为`PENDING`等待中、`PROCESSING`处理中（正在计算相似度等）、`PASSED`审核通过、`REJECTED`已被拒。

##### 约束

```mysql
ALTER TABLE `defect_report`
  ADD CONSTRAINT `TEST_RECORD_ID` FOREIGN KEY (`test_record_id`) REFERENCES `test_record` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `task` 测试任务表

##### 用途

用来存放发包方发布的任务。

##### 结构

```mysql
CREATE TABLE `task` (
  `id` bigint UNSIGNED NOT NULL,
  `exe_file_path` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `discrib_file_path` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `task_discribe` text NOT NULL,
  `start_time` datetime NOT NULL,
  `finish_time` datetime NOT NULL,
  `total_num` int NOT NULL,
  `current_num` int NOT NULL,
  `type` enum('FUNCTION','PERFORMANCE') NOT NULL,
  `user_id` bigint NOT NULL,
  `device_brand` enum('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER') NOT NULL,
  `operating_system` enum('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') NOT NULL,
  `difficulty` int DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 任务id

`exe_file_path` 可执行文件地址

`discrib_file_path` 描述文件地址

`task_discribe` 任务描述

`start_time` 任务开始时间

`finish_time`任务结束时间

`total_num` 任务招募人数

`current_num` 任务当前人数

`type` 任务种类

`user_id` 发布者id

`device_brand` 设备品牌 'LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER'

`operating_system` 设备对应操作系统类型 ('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER')

`difficulty` 难度

##### 约束

```sql
ALTER TABLE `task`
  ADD CONSTRAINT `USER_ID_TASK` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `test_record` 测试记录表

##### 用途

用于记录众测工人接下测试任务的记录。

##### 结构

```sql
CREATE TABLE `test_record` (
  `id` bigint UNSIGNED NOT NULL,
  `task_id` bigint NOT NULL,
  `user_id` bigint NOT NULL,
  `finished` tinyint(1) NOT NULL,
  `commit_time` datetime NOT NULL,
  `finish_time` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 报告id

`task_id` 对应任务id

`user_id` 创建者id

`finished` 是否完成测试

`commit_time` 提交日期

`finished_time` 完成日期

##### 约束

```mysql
ALTER TABLE `test_record`
  ADD CONSTRAINT `TASK_ID` FOREIGN KEY (`task_id`) REFERENCES `task` (`id`) ON UPDATE RESTRICT,
  ADD CONSTRAINT `USER_ID` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON UPDATE RESTRICT;
```



#### `user` 用户表

##### 用途

用来记录用户信息。

##### 结构

```mysql
CREATE TABLE `user` (
  `id` bigint UNSIGNED NOT NULL,
  `uname` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `email` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `user_role` enum('PUBLISHER','WORKER','ADMINISTRATOR') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `create_time` datetime NOT NULL,
  `credit` int NOT NULL,
  `level` int NOT NULL,
  `prefer_types` enum('FUNCTION','PERFORMANCE') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 用户身份id

`uname` 用户名

`password` 密码

`email` 邮件

`user_role` 用户角色

`create_time` 用户注册时间

`credit` 信誉分

`prefer_types` 偏好任务类型



#### `user_device` 用户设备表

##### 用途

用来记录用户拥有的设备，用于实现用户推荐。

##### 结构

```mysql
CREATE TABLE `user_device` (
  `id` bigint UNSIGNED NOT NULL,
  `user_id` bigint NOT NULL,
  `operating_system` enum('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') NOT NULL,
  `device_brand` enum('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 用户设备表记录ID。注意到一个用户可能拥有多种设备，所以会对应于多条记录。

`user_id` 用户身份id。

`operating_system` 设备对应操作系统类型 ('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER')

`device_brand` 设备品牌 'LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER'

##### 约束

```mysql
ALTER TABLE `user_device`
  ADD CONSTRAINT `user_device_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



####  `additional_report` 补充报告表

##### 用途

用来记录报告协作过程产生的补充报告。

##### 结构

```mysql
CREATE TABLE `additional_report` (
  `id` bigint UNSIGNED NOT NULL,
  `defect_report_id` bigint NOT NULL,
  `test_record_id` bigint NOT NULL,
  `screenshot_path_list` text NOT NULL,
  `description` text NOT NULL,
  `operating_system` enum('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') NOT NULL,
  `device_brand` enum('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER') NOT NULL,
  `create_time` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 补充报告id

`defect_report_id` 对应缺陷报告id

`test_record_id` 对应测试报告id

`screenshot_path_list` 截图路径列表

`description` 描述内容

`operating_system` 设备对应操作系统类型 ('WINDOWS','LINUX','MACOS','ANDROID','IOS','IPADOS','OTHER') 

`device_brand` 设备品牌 ('LENOVO','DELL','HP','ASUS','GIGABYTE','MSI','HUAWEI','XIAOMI','SAMSUNG','IPHONE','OPPO','VIVO','ONEPLUS','IQOO','REALME','PIXEL','LG','NOKIA','OTHER')

`create_time` 缺陷报告发布时间

##### 约束 

```mysql
ALTER TABLE `additional_report`
  ADD CONSTRAINT `additional_report_report_con` FOREIGN KEY (`defect_report_id`) REFERENCES `defect_report` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  ADD CONSTRAINT `additional_report_test_record` FOREIGN KEY (`test_record_id`) REFERENCES `test_record` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `remark` 报告评价表

##### 用途

用来记录报告写作过程中产生的报告评价。

##### 结构

```mysql
CREATE TABLE `remark` (
  `id` bigint UNSIGNED NOT NULL,
  `test_record_id` bigint NOT NULL,
  `score` int NOT NULL,
  `description` text NOT NULL,
  `create_time` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 评价id

`test_record_id` 对应测试记录id

`score` 评分，1到5

`description` 评价文本

`create_time` 发表时间

##### 约束

```mysql
ALTER TABLE `remark`
  ADD CONSTRAINT `remark_defect_report` FOREIGN KEY (`defect_report_id`) REFERENCES `defect_report` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  ADD CONSTRAINT `remark_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `similarity` 报告相似度表

##### 用途

记录两份缺陷报告之间的相似度。

##### 结构

````mysql
CREATE TABLE `similarity` (
  `id` bigint NOT NULL,
  `defect_report_id_1` bigint NOT NULL,
  `defect_report_id_2` bigint NOT NULL,
  `similarity` double NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
````

`id` 评价id

`defect_report_id_1` 缺陷报告1

`defect_report_id_2` 缺陷报告2

`similarity` 相似度值

##### 约束

```mysql
ALTER TABLE `similarity`
  ADD CONSTRAINT `sim_report_1` FOREIGN KEY (`defect_report_id_1`) REFERENCES `defect_report` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  ADD CONSTRAINT `sim_report_2` FOREIGN KEY (`defect_report_id_2`) REFERENCES `defect_report` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `task_ratings` 任务评价表

##### 用途

记录用户对于任务的评价，以用于任务推荐。

##### 结构

```mysql
CREATE TABLE `task_ratings` (
  `user_id` bigint NOT NULL,
  `task_id` bigint NOT NULL,
  `score` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`user_id` 用户id

`task_id` 任务id

`score` 用户评分

##### 约束

```mysql
ALTER TABLE `task_ratings`
  ADD CONSTRAINT `task_rating_task` FOREIGN KEY (`task_id`) REFERENCES `task` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  ADD CONSTRAINT `task_rating_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```



#### `message` 消息推送表

##### 用途

用于存储要给用户推送的消息。

##### 结构

```mysql
CREATE TABLE `message` (
  `id` bigint UNSIGNED NOT NULL,
  `user_id` bigint NOT NULL,
  `content` text NOT NULL,
  `time` datetime NOT NULL,
  `status` enum('NEW','READ') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 消息id

`user_id` 用户id

`content` 消息正文

`time` 推送时间

`status` 状态

##### 约束

```mysql
ALTER TABLE `message`
  ADD CONSTRAINT `message_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```

#### `activeness` 用户活跃度表

##### 用途

存储用户活跃度信息

##### 结构

```sql
CREATE TABLE `activeness` (
  `id` bigint NOT NULL,
  `lastBugTime` datetime DEFAULT NULL,
  `uid` bigint NOT NULL,
  `lastReportTime` datetime DEFAULT NULL,
  `lastTaskTime` datetime DEFAULT NULL,
  `numbugs_week` bigint NOT NULL,
  `numbugs_month` bigint NOT NULL,
  `numreports_week` bigint NOT NULL,
  `numreports_month` bigint NOT NULL,
  `numtasks_week` bigint NOT NULL,
  `numtasks_month` bigint NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

-- --------------------------------------------------------

 `id`主键,

  `lastBugTime` datetime 最近一个被通过的bug的时间,

  `uid` 用户id,

  `lastReportTime` 最近一次提交报告被审核通过的时间,

  `lastTaskTime` 最近一次参与任务的时间,

  `numbugs_week` 最近一周内发现的bug总数,

  `numbugs_month`最近一个月内发现的bug总数,

  `numreports_week` 最近一周通过报告数,

  `numreports_month`最近一个月通过的报告数,

  `numtasks_week` 最近一周参与的任务数,

  `numtasks_month`最近一个月参与的任务数



#### `user_capability` 用户能力表

##### 用途

存储用户能力值信息

##### 结构

```sql
CREATE TABLE `user_capability` (
  `id` bigint NOT NULL,
  `uid` bigint NOT NULL,
  `Collaboration` double NOT NULL COMMENT '报告协作能力',
  `censorship_ability` double NOT NULL COMMENT '报告审查能力',
  `average_remark` double NOT NULL COMMENT '平均评价分数',
  `report_repeatability` double NOT NULL COMMENT '报告重复度',
  `duplicate_bug_per` double NOT NULL COMMENT '重复bug百分比',
  `professional_ability` bigint NOT NULL COMMENT '专业能力',
  `total_bug_nums` bigint NOT NULL COMMENT '总bug数'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```



 `id` 主键,

  `uid`用户id,

  `Collaboration` 报告协作能力,

  `censorship_ability` 报告审查能力,

  `average_remark` 平均评价分数,

  `report_repeatability` 报告重复度,

  `duplicate_bug_per`重复bug百分比,

  `professional_ability` 专业能力,

  `total_bug_nums` 总bug数

#### `report_review` 报告评审表

##### 用途

存储报告评审记录信息

##### 结构

```sql
CREATE TABLE `report_review` (
  `id` bigint NOT NULL,
  `report_id` bigint NOT NULL,
  `bug_nums` int NOT NULL,
  `score` double NOT NULL,
  `is_repeat_bug` tinyint(1) NOT NULL,
  `accepted` tinyint(1) NOT NULL,
  `create_time` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```



  `id` 主键,

  `report_id` 报告id

  `bug_nums`报告里提到的bug数

  `score` 发包方对报告打分,

  `is_repeat_bug` 判断是否和已有bug重复,

  `accepted`是否接受该报告,

  `create_time` 评审时间

#### `dup_bug `重复报告记录表

##### 用途

用来记录重复bug信息

##### 结构

```mysql
CREATE TABLE `dup_bug` (
  `id` int NOT NULL,
  `reportId` int NOT NULL,
  `dupId` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 自增主键

`reportId` 该重复bug属于哪一个测试报告

`dupId` 与哪一份报告发现的bug重复

##### 约束

```mysql
ALTER TABLE `dup_bug`
  ADD PRIMARY KEY (`id`);
ALTER TABLE `dup_bug`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;
```



#### `report_descriptor` 报告描述性词表

##### 用途

存放缺陷报告的描述性词

##### 结构

```mysql
CREATE TABLE `report_descriptor` (
  `id` int NOT NULL,
  `words` text NOT NULL,
  `reportId` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

```

`id` 自增主键

`words` 描述性词

`reportId`	对应的缺陷报告id

##### 约束

```mysql
ALTER TABLE `report_descriptor`
  ADD PRIMARY KEY (`id`);
ALTER TABLE `report_descriptor`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;
```



#### `task_descriptor` 任务描述性词表

##### 用途

存放任务的描述性词

##### 结构

```mysql
CREATE TABLE `task_descriptor` (
  `id` bigint NOT NULL,
  `words` text NOT NULL,
  `taskId` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 自增主键

`words` 描述性词

`reportId`	对应的任务id

##### 约束

```mysql
ALTER TABLE `task_descriptor`
  ADD PRIMARY KEY (`id`);
ALTER TABLE `task_descriptor`
  MODIFY `id` bigint NOT NULL AUTO_INCREMENT;
```



#### `user_descriptor` 用户描述性词表

##### 用途

存放用户的描述性词

##### 结构

```mysql
CREATE TABLE `user_descriptor` (
  `id` bigint NOT NULL,
  `words` text NOT NULL,
  `userId` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

`id` 自增主键

`words` 描述性词

`userId`	对应的任用户id

##### 约束

```mysql
ALTER TABLE `user_descriptor`
  ADD PRIMARY KEY (`id`);
ALTER TABLE `user_descriptor`
  MODIFY `id` bigint NOT NULL AUTO_INCREMENT;
```



